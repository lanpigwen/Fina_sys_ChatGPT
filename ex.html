<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
    <title>Chatbot</title>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <style>


        /* 整个页面的背景色 */
        body {
            background-color: #f0f0f0;
        }
        /* 对话框容器的样式 */
        #messages {
            width: 70%; /* 对话框容器的宽度 */
            margin: 0 auto; /* 居中显示 */
            background-color: #b3b0b0; /* 对话框容器的背景色 */
            border-radius: 10px; /* 对话框容器的圆角 */
            padding: 20px; /* 对话框容器的内边距 */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2); /* 对话框容器的阴影 */
            overflow-y: auto; /* 对话框内容超出容器高度时自动滚动 */
            min-height: 500px;
            max-height: 500px; /* 对话框容器的最大高度，超出时出现滚动条 */
        }
        /* 单个消息的样式 */
        .message {
            margin-bottom: 10px; /* 单个消息的下边距 */
            padding: 10px; /* 单个消息的内边距 */
            border-radius: 10px; /* 单个消息的圆角 */
            clear: both;
            overflow-wrap: break-word; /* 长消息自动换行 */
        }
        /* 用户发送的消息的样式 */
        .message-sent {
            background-color: #F1F0F0;
            color: #000000;
            float: right;
        }
        /* 机器人回复的消息的样式 */
        .message-received {
            background-color: #0084FF;
            color: #FFFFFF;
            float: left;
        }
        /* 输入框和发送按钮容器的样式 */
        #input-container {
            /* background-color: #b3b0b0; */
            width: 70%; /* 输入框容器的宽度 */
            margin: 0px auto 0; /* 上边距20px，居中显示 */
            display: flex; /* 使用flex布局 */
            align-items: center; /* 垂直居中 */
            justify-content: space-between; /* 两个子元素之间间距最大 */
            border: none;
        }
        /* 输入框的样式 */
        #message {
            flex: 1; /* 自动调整宽度 */
            padding: 10px; /* 输入框的内边距 */
            border: none; /* 去除边框 */
            border-radius: 5px; /* 输入框的圆角 */
            font-size: 16px; /* 输入框的字体大小 */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2); /* 输入框的阴影 */
            overflow-y: auto;
            height: 20px;/* 输入框的最小高度 */
            max-height: 200px;
            resize: none;
            outline:none;
        }
        /* 发送按钮的样式 */
        #send {
            padding: 10px 20px;/* 发送按钮的内边距 */
            border: none; /*去除边框 */
            border-radius: 5px; /* 发送按钮的圆角*/
            font-size: 16px; /* 发送按钮的字体大小 */
            background-color: #0084FF; /* 发送按钮的背景色 */
            color: #FFFFFF; /* 发送按钮的字体颜色 */
            cursor: pointer; /* 鼠标指针样式 */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2); /* 发送按钮的阴影 */
            }
        .bottom
        {
            border: none;
            position:absolute;
            right:0px;
            bottom:0px;
            background:#f0f0f0;
            color:#929292;
            display:block;
            width:100%;
            text-align:center;
            z-index: 10;
        }
        .bottom span
        {
            font-size: 10px;
            position:relative;
            display:block;
            left:0;

        }

</style>

</head>
<body>
<h2 align="center"><b>基于ChatGPT的财务分析系统</b></h2>
    <div id="messages"></div>
    <div class="bottom">
        <div id="input-container">
            <textarea id="message" placeholder="请输入..."></textarea>
            <button type="button" id="send">发送</button>
        </div>
        <span class="style4">  </span>
        <span an class="style4">  </span>
        <!-- <span class="style4">@BLCU挑战杯——基于ChatGPT的财务分析系统</span><br /> -->
        <br/>
        <span class="style4">版权声明：分析结果全部来自openai的开放接口chatgpt-3.5-turbo</span> <br />
        <span class="style4">结果仅供参考 谨慎使用</span>
    </div>

    <script>

        let sessionId = null;
        // 将对话框滚动到底部
        function scrollToBottom() {
            var messages = document.getElementById("messages");
            messages.scrollTop = messages.scrollHeight;
        }
        // 发送消息
    function sendMessage() {

        var message = document.getElementById("message").value;
        var messageShow=message.replace(/\n/g,"<br>");
        if (message.trim() == "") {
            return;
        }
        // 在对话框中显示发送的消息
        var messages = document.getElementById("messages");
        var messageSent = document.createElement("div");
        messageSent.innerHTML = messageShow;
        messageSent.className = "message message-sent";
        messages.appendChild(messageSent);
        scrollToBottom();
        // 清空输入框
        document.getElementById("message").value = "";
        document.getElementById("message").style.height="20px";
        
        // 向后端发送请求
        $.ajax({
            type: "POST",
            url: "/chat",
            contentType: "application/json",
            data: JSON.stringify({"message": message,"session_id":sessionId}),
            success: function(data) {
                // 在对话框中显示接收的消息
                var messageReceived = document.createElement("div");
                messageReceived.innerHTML = data["message"];
                messageReceived.className = "message message-received";
                messages.appendChild(messageReceived);
                sessionId=data["session_id"];
                scrollToBottom();
            },
            error: function(error) {
                console.log(error);
            }
        });
    }

    // 发送按钮点击事件
    document.getElementById("send").addEventListener("click", function() {
        sendMessage();
    });

    // 回车键按下事件   最好不要添加这个
    // document.getElementById("message").addEventListener("keydown", function(event) {
    //     if (event.keyCode == 13) {
    //         sendMessage();
    //     }
    // });

    var textarea = document.querySelector('textarea');
    
    textarea.addEventListener('input', (e) => {
        textarea.style.height = '20px';
        textarea.style.height = e.target.scrollHeight-20 + 'px';
    });
      </script>
</body>
</html>
